datasource db {
  provider = "postgresql"
  url      = env("HEALTH_DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  output        = "./generated/health-client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

model Baseline {
  id        String   @id @default(cuid())
  userId    String   @unique // one baseline per user
  birthdate DateTime
  height    Float
  weight    Float
  smoker    Boolean
  diabetes  Boolean
}

model Lifestyle {
  id         String   @id @default(cuid())
  userId     String
  recordedAt DateTime @default(now())
  data       Json // restingHr, vo2max, activeMinutes, sleepHours, spo2

  @@index([userId, recordedAt(sort: Desc)])
}

model Medical {
  id         String   @id @default(cuid())
  userId     String
  recordedAt DateTime @default(now())
  data       Json // sbp, ldl, hdl, glucose, triglycerides

  @@index([userId, recordedAt(sort: Desc)])
}

model Assessment {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())

  lifestyleId String? // the triggering lifestyle input
  medicalId   String? // the triggering lab results input

  miScore     Int
  strokeScore Int
  hfScore     Int

  @@index([userId, createdAt(sort: Desc)])
}
